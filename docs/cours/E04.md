# API E04 - REST & CRUD (partie 2)

## Menu du jour

```
=== Matin COURS ===

- Correction & bonnes pratiques d'API
  - ✅ Validations des entrées
  - ✅ Gestion des erreurs
  - ✅ Praticité et performances
  - ✅ Testing HTTP : Insomnia / Thunder Client

- Des bonus à foisons
  - ✅ (bonus) Versionner une API
  - ✅ (bonus) Multi-router
  - ✅ (bonus) Une 404
  - (bonus) Documentation Swagger
  - (bonus) Amélioration de la gestion d'erreur

=== Aprem ATELIER ===

- Terminer l'API en prenant en compte les bonnes pratiques
```



## Insomnia ou front ?

**Insomnia** : est un outil pour TESTER une API lors du developpement
- requête avec des boutons

**Front** : l'interface qui communique avec notre API en production. 
- requête avec des boutons => `fetch()` / `axios`




## Extension VSCode

`Thunder Client` : HTTP Client intégré à VSCode

## Praticité VS Performance

Lorsqu'on écrit une API, on essaie si possible de la rendre PRATIQUE aux clients qui vont s'en servir !
- typiquement, si la rajoute `/lists` renvoie toutes les listes en incluant les cartes et les `tags` de ces `cartes`, ça serait super pratique

Lorsqu'on écrit une API, on fait attention également aux performances de notre API : 
- si on a 1M de listes en BDD, et qu'on récupère tout (+ les cartes et tags), on va bourrer la RAM !

Comment améliorer : 
- mettre de la pagination (ex : `limit=20`)
- ne pas inclure tous les modèles systématiquement
- notion de cache 

Objectif :
- trouver un **juste milieu entre performance et praticité** !

## Rules of API

Règle d'or n°1 : 
- **never trust user inputs**

Règle d'or n°2 : 
- **pas de breaking changes** :
  - ex : retrait d'une route
  - ex : retrait de champs d'une route 

- Si vraiment besoin de modifier 
  - on rajoute une nouvelle route 
  - ex: `GET /v2/lists`
  - puis progressivement "Sunset" la première route (au moins > 6 mois)

Ici pour nous, on va pas faire de `/v1`.
- par contre, pour montrer le principe, on va préfixer nos routes api par un `/api`
  - ex : `/lists` ==> `/api/lists`
- ce qui peut être pratique si notre serveur Express sert à la fois notre `API` (`/api`) et notre `front` (`/`) en S13.

Attention : 
- cette aprem', lorsque vous testez vos routes `/tags`, il faudra penser au `/api`

## Validations

- **Côté DB** (schéma de données SQL / Sequelize) : 
  - assure la cohérence de la BDD en tant que système autonome

- **Côté API** (joi / vanilla JS)
  - assure la communication avec le client qui fait des bétises et renvoyer des 400

