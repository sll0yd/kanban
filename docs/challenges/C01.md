# O'Kanban - API E01 - Atelier Conception & gestion de projet

[Rappel : lien pour créer des issues](https://github.com/O-clock-Quinoa/Soutien-ateliers/issues)

## Étape 1 - Mise en place `Git`

Une fois le `ochallenge` accepté et cloné, pensez à **créer une branche** `jour1` :

- `git checkout -b jour1`

Et n'hésitez pas à `push` cette branche sur `Github` :

- `git push --set-upstream origin jour1` la première fois
- `git push` les fois suivantes

## Étape 2 - Analyse du besoin client

**Objectif : créer un Kanban de gestion de projet**  (type `Trello`, `Github Projet`…)

- on souhaite créer une application présentant un « board de gestion de projet », où il est possible de créer des **cartes** à l'intérieur de **listes** ;
- l'utilisateur (unique, pas besoin de le stocker en BDD) peut créer autant de listes qu'il/elle désire et ajouter autant de cartes à l'intérieur de ces listes ;
- chaque liste dispose d'un `titre` et d'une `position` au sein du board ;
- chaque carte dispose d'un `contenu`, d'une `position` au sein de la liste, d'une `couleur` (optionnelle) et d'un ou plusieurs **label(s)** (optionnel(s)) ;
- un label a un `nom` (ex : Urgent) et peut avoir une `couleur` (optionnelle).

On se base sur ce besoin client, et on souhaite faire l'analyse de ce besoin en vue de produire le `MCD` de l'application. **N'hésitez pas à créer une issue si vous souhaitez clarifier un point auprès du client**

## Étape 3 - User Stories

Écrire quelques « récits utilisateur » (`user stories`) à consigner dans un tableau `Markdown` dans un fichier `docs/resources/user-stories.md`.

Rappels :

- une `user story` est un **scenario de test** qui nous aide à clarifier notre besoin, comprendre les fonctionnalités attendues dans notre application, et nous permet de vérifier si l'implémentation correspond bien aux récits fixés préalablement ;
- le formalisme habituel : `En tant que [ROLE], je souhaite [ACTION] (( afin de [OBJECTIF] ))`.

## Étape 4 - Wireframes

Faire un bref `wireframe` pour notre application à l'aide de votre outil préféré :

- `TLDraw`
- `Draw.io`
- `Excalidraw`
- `Microsoft Paint` pour les plus aventureux
- …

Rappels :

- un `wireframe` est un **croquis fonctionnel** qui nous aide à comprendre les fonctionnalités de notre application et les interactions possibles avec l'utilisateur ;
- il est possible d'avoir plusieurs wireframes d'une même page, par exemple selon les différents états de l'utilisateur (mobile, connecté/deconnecté…).

## Étape 5 - Modèle Conceptuel de Données (MCD)

**Première étape de modélisation (MERISE): que doit-on stocker ?**

Dessinez le MCD en utilisant l'outil de votre choix :

- un papier et un crayon
- [draw.io](https://draw.io)
- [MoCoDo](http://mocodo.wingi.net/) (cf. [fiche recap](https://kourou.oclock.io/ressources/fiche-recap/mocodo/))
- [Whimsical](https://whimsical.com/)
- …

Rappels :

- le MCD découle du besoin : il arrive souvent d'avoir plusieurs modélisations possibles pour un même problème !
- n'hésitez pas à refaire un tour sur la [fiche recap' du MCD](https://kourou.oclock.io/ressources/fiche-recap/mcd-modele-conceptuel-de-donnees/) ;
- [autre article complet](https://gist.github.com/enzoclock/3b16a04277a9ef620ed046aaf4149c4b).

## Étape 6 - Modèle Logique de Données (MLD)

Traduire le MCD de l'application sous forme de MLD en utilisant les [règles de transformation](https://kourou.oclock.io/ressources/fiche-recap/mld/).

Le formalisme attendu est, au choix :

- sous forme de texte
- sous forme d'un schéma
- ou les deux !

Rappels :

- l'étape du MLD est une étape de traduction :
  - traduire les noms des entités en nom de tables ;
  - traduire les noms des attributs en nom de colonnes ;
  - traduire les associations et leurs cardinalités en clés étrangères et/ou tables de liaison.

## Etape 6 - Bis (Facultatif) - Pull Request 

Si vous n'êtes pas sûr de votre MLD, avant de passer à l'étage suivante, n'hésitez pas à faire une Pull Request sur votre dépôt (`jour1`->`master`) et d'ajouter le prof en reviewer (`@enzoclock`)

## Étape 7 - Créer la base de données et l'utilisateur

À l'aide du client `psql` :

- créer un utilisateur Postgres : `okanban` (avec un mot de passe `okanban`)
- créer une BDD pour notre application : `okanban`

Vérifier la bonne création de la BDD et de l'utilisateur.

## (BONUS) Étape 8 - Modèle Sequelize d'une liste

Étape bonus, exploratoire et facultative : anticipation du cours suivant.

Idée : **il est possible de créer les tables à l'aide de Sequelize plutôt qu'avec nos scripts SQL** !

A défaut de faire l'exercice, la lecture de l'énoncé est recommandée !

### Révision - SQL

Commençons par **réviser la création d'une table en SQL** :

- écrire un script `src/migrations/create_table.sql` pour créer la table `list (title, position, created_at, updated_at)` ;
- l'exécuter sur la BDD `okanban` et vérifier qu'elle est bien créée (`\dt`) ;
- insérer manuellement un élément dans cette table pour tester.
  
> Créer uniquement la table `List` fera tout à fait l'affaire pour ce bonus.
> Si vous souhaitez écrire les autres tables, en précisant les clés étrangères et tables de liaisions, c'est tout à fait possible et une correction vous sera fournie à titre indicatif.

### Révision - Client Sequelize

- initialiser `NPM` dans le dépôt ;
- installer `sequelize`, `pg` et `dotenv` ;
- créer un fichier `.env` et `.env.example` contenant l'adresse `PG_URL` de notre BDD ;
- créer un fichier `src/models/sequelizeClient.js` pour initialiser un client de connexion Sequelize vers notre BDD et l'exporter ;
- créer un modèle Sequelize : `List` avec les attributs appropriés ;
- le tester pour vérifier son bon fonctionnement.

### Découverte - Synchroniser le modèle avec la BDD

Créer un script `src/migrations/01.createTables.js`.

L'objectif de ce script est d'utiliser notre modèle Sequelize fraichement créé pour :

- supprimer la table `List` existante de notre BDD → on peut utiliser la [méthode `drop()`](https://sequelize.org/docs/v6/core-concepts/model-basics/#dropping-tables) ;
- re-créer la table `List`, mais cette fois-ci définie à partir du modèle ! → on peut utiliser la [méthode `sync()`](https://sequelize.org/docs/v6/core-concepts/model-basics/#model-synchronization).

Exécuter le fichier avec `node` et vérifier sa bonne exécution (pas d'erreur, table bien présente en BDD…).

### Découverte - Échantillonnage via notre modèle Sequelize

Créer un script `src/migrations/02.seedTables.js`.

L'objectif de ce script est d'insérer des « données de test » dans notre table `list`. Pour cela, on peut utiliser la méthode `create()` de notre modèle.

Exécuter le script avec `node` et vérifier la bonne présence des données de test en BDD.

### Fin

**Bravo** : vous avez réalisé votre modèle physique de données (MPD) directement à partir du modèle `Sequelize` ! Il n'y a donc pas de redondance et/ou d'incohérence entre le modèle `Sequelize` et le fichier `SQL` (que l'on pourrait d'ailleurs supprimer).